from django.db.models import F

def fix_user_profiles():
    # Получаем всех пользователей
    users = User.objects.all()
    
    for user in users:
        # Получаем профиль пользователя
        profile = UserProfile.objects.filter(user=user).first()
        
        # Проверяем, соответствует ли id профиля id пользователя
        if profile and profile.id != user.id:
            # Создаем новый профиль для пользователя
            new_profile = UserProfile.objects.create(user=user, avatar=profile.avatar)
            
            # Удаляем старый неправильный профиль
            profile.delete()
            
            print(f"Fixed profile for user: {user.username}")
